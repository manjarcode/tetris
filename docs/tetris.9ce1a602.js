!function(){function e(e){if(e=a.i?.[e]||e,!t)try{throw Error()}catch(s){var n=(""+s.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(!n)return i+e;t=n[0]}return new URL(i+e,t).toString()}var t,n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i="./",s={},r={},a=n.parcelRequire685b;null==a&&((a=function(e){if(e in s)return s[e].exports;if(e in r){var t=r[e];delete r[e];var n={id:e,exports:{}};return s[e]=n,t.call(n.exports,n,n.exports),n.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){r[e]=t},n.parcelRequire685b=a),a.register,Object.assign(a.i??={},{"8mJIW":"s.8adb7d0e.png",auyvD:"t.1a22270f.png",jQriX:"l.66e5de53.png",hotXP:"z.5c6e7042.png",hic7r:"stick.29508506.png",kehWT:"seven.a36daa0f.png","1KxUL":"square.02a09eec.png"});let h=["#FF6B6B","#FF9F1C","#FFD23F","#17C3B2","#227C9D","#8B5CF6","#E6E6EA"],o=["#C34C4C","#B36D14","#B8962E","#0F8175","#165166","#5A3EAB","#A1A1A5"];class w{constructor(e,t,n,i,s){this.x=e,this.y=t,this.color=n,this.matrix=i,this.snapshot=s}getPosition(){return new l(this.x,this.y)}getColor(){return this.color}canTranslate(e){return new w(this.x+e.x,this.y+e.y,this.color,this.matrix,this.snapshot).isValid()}translate(e){this.x=this.x+e.x,this.y=this.y+e.y}consolidate(){this.matrix.at(this.x,this.y).set(this.color)}toString(){return`(${this.x},${this.y})`}relativeTo(e){return new l(this.x-e.x,this.y-e.y)}takeSnapshot(){this.snapshot=[this.x,this.y]}isValid(){let e=this.x>=0&&this.x<10,t=this.y>=0&&this.y<20;return!!e&&!!t&&0===this.matrix.at(this.x,this.y).get()}}class l{constructor(e,t){this.x=e,this.y=t}*[Symbol.iterator](){yield this.x,yield this.y}toString(){return`${String(this.x)}${String(this.y)}`}}class c{#e;#t;#n;constructor(e,t){this.mainScreen=e,this.pieceBuilder=t,this.iteration=0,this.isOver=!1,this.#e=!1,this.#t=!1,this.active=this.pieceBuilder.getRandom(4,0),this.#n=this.pieceBuilder.getRandom(0,0),this.active.getImage(),this.mainScreen.drawNext(this.#n.getImage())}wannaLeft(){this.move=1}wannaRight(){this.move=2}wannaRotate(){this.#e=!0}togglePause(){this.#t=!this.#t}over(){this.mainScreen.gameOver()}iterate(){this.#t||(this.#i(),this.#e&&(this.active.wannaRotate(),this.#e=!1),this.#s()&&this.#r(),this.#a())}#i(){1===this.move&&this.active.wannaLeft(),2===this.move&&this.active.wannaRight(),this.move=0}#s(){return this.iteration++%10==0}#r(){this.active.canDown()?this.active.down():this.#h()}#h(){this.#o(),this.mainScreen.clearLines(),this.#w()}#o(){this.active.destroy(),this.active=null,this.active=this.#n,this.active.translate(new l(4,0)),this.#n=null,this.#n=this.pieceBuilder.getRandom(1,1),this.mainScreen.drawNext(this.#n.getImage())}#w(){this.isOver=!this.active.canDown()}#a(){this.mainScreen.render(this.active)}}class u{constructor(e){this.rotations=e}apply(e){let t=this.rotations.find(t=>t.from.x===e.x&&t.from.y===e.y);return t||console.log(`Rotation not found (${e.x},${e.y})`),t.to}}class d{constructor(e,t){this.from=e,this.to=t}}class m{#l;#c;constructor(e,t,n,i){this.#l=e.sort((e,t)=>t.y-e.y),this.rotateCenter=t,this.rotateTable=n,this.#c=i}getBlocks(){return this.#l}wannaLeft(){let e=new l(-1,0);this.translate(e)}wannaRight(){let e=new l(1,0);this.translate(e)}#u(e){return this.#l.every(t=>t.canTranslate(e))}translate(e){if(this.#u(e))for(let t of this.#l)t.translate(e)}wannaRotate(){this.canRotate()&&this.rotate()}canRotate(){throw Error("must be implemented")}rotate(){throw Error("must be implemented")}canDown(){let e=new l(0,1);return this.#u(e)}down(){let e=new l(0,1);this.translate(e)}destroy(){for(let e of this.#l)e.consolidate();for(let e of this.#l);}getImage(){return this.#c}toString(){return this.#l.map(e=>e.toString())}}class x extends m{constructor(e,t,n,i){super(e,t,n,i)}canRotate(){return!!this.rotateTable&&this.getBlocks().reduce((e,t)=>{let n=t.relativeTo(this.rotateCenter),i=this.rotateTable.apply(n);return e&&t.canTranslate(i)},!0)}rotate(){for(let e of this.getBlocks()){let t=e.relativeTo(this.rotateCenter),n=this.rotateTable.apply(t);e.translate(n)}}}class g extends m{constructor(e,t,n,i,s){super(e,t,n,s),this.isInverted=!1,this.reverseRotateTable=i}canRotate(){if(!this.rotateTable)return!1;let e=this.isInverted?this.reverseRotateTable:this.rotateTable;return this.getBlocks().reduce((t,n)=>{let i=n.relativeTo(this.rotateCenter),s=e.apply(i);return t&&n.canTranslate(s)},!0)}rotate(){let e=this.isInverted?this.reverseRotateTable:this.rotateTable;for(let t of this.getBlocks()){let n=t.relativeTo(this.rotateCenter),i=e.apply(n);t.translate(i)}this.isInverted=!this.isInverted}}var f={};f=e("1KxUL");var v={};v=e("auyvD");var y={};y=e("kehWT");var p={};p=e("jQriX");var b={};b=e("hic7r");var R={};R=e("hotXP");var S={};S=e("8mJIW");class T{constructor(e){this.matrix=e}getRandom(e,t){let n=[this.buildSquare,this.buildT,this.buildSeven,this.buildL,this.buildZ,this.buildS,this.buildStick],i=Math.floor(Math.random()*n.length);return n[i].bind(this)(e,t)}buildSquare(e,t){let n=new w(e+0,t+0,1,this.matrix),i=new w(e+1,t+0,1,this.matrix),s=new w(e+0,t+1,1,this.matrix);return new x([n,i,s,new w(e+1,t+1,1,this.matrix)],null,null,new URL(f).href)}buildT(e,t){let n=new w(e+1,t+0,2,this.matrix),i=new w(e+1,t+1,2,this.matrix),s=new w(e+1,t+2,2,this.matrix),r=new w(e+0,t+1,2,this.matrix);return new x([n,i,s,r],i,new u([new d(new l(0,0),new l(0,0)),new d(new l(-1,0),new l(1,-1)),new d(new l(1,0),new l(-1,1)),new d(new l(0,1),new l(-1,-1)),new d(new l(0,-1),new l(1,1))]),new URL(v).href)}buildSeven(e,t){let n=new w(e+0,t+0,3,this.matrix),i=new w(e+0,t+1,3,this.matrix),s=new w(e+0,t+2,3,this.matrix),r=new w(e+1,t+0,3,this.matrix);return new x([n,i,s,r],i,new u([new d(new l(0,0),new l(0,0)),new d(new l(-1,0),new l(1,-1)),new d(new l(1,0),new l(-1,1)),new d(new l(0,1),new l(-1,-1)),new d(new l(0,-1),new l(1,1)),new d(new l(1,-1),new l(0,2)),new d(new l(1,1),new l(-2,0)),new d(new l(-1,1),new l(0,-2)),new d(new l(-1,-1),new l(2,0))]),new URL(y).href)}buildL(e,t){let n=new w(e+1,t+0,4,this.matrix),i=new w(e+1,t+1,4,this.matrix),s=new w(e+1,t+2,4,this.matrix),r=new w(e+0,t+0,4,this.matrix);return new x([n,i,s,r],i,new u([new d(new l(0,0),new l(0,0)),new d(new l(-1,0),new l(1,-1)),new d(new l(1,0),new l(-1,1)),new d(new l(0,1),new l(-1,-1)),new d(new l(0,-1),new l(1,1)),new d(new l(1,-1),new l(0,2)),new d(new l(1,1),new l(-2,0)),new d(new l(-1,1),new l(0,-2)),new d(new l(-1,-1),new l(2,0))]),new URL(p).href)}buildStick(e,t){let n=new w(e+0,t+0,5,this.matrix),i=new w(e+0,t+1,5,this.matrix),s=new w(e+0,t+2,5,this.matrix),r=new w(e+0,t+3,5,this.matrix),a=new u([new d(new l(0,0),new l(0,0)),new d(new l(0,-1),new l(-1,1)),new d(new l(0,1),new l(1,-1)),new d(new l(0,2),new l(2,-2))]);return new g([n,i,s,r],i,a,new u([new d(new l(0,0),new l(0,0)),new d(new l(-1,0),new l(1,-1)),new d(new l(1,0),new l(-1,1)),new d(new l(2,0),new l(-2,2))]),new URL(b).href)}buildZ(e,t){let n=new w(e-1,t+0,6,this.matrix),i=new w(e+0,t+0,6,this.matrix),s=new w(e+0,t+1,6,this.matrix),r=new w(e+1,t+1,6,this.matrix),a=new u([new d(new l(0,0),new l(0,0)),new d(new l(-1,-1),new l(2,0)),new d(new l(0,-1),new l(1,1)),new d(new l(1,0),new l(-1,1))]);return new g([n,i,s,r],s,a,new u([new d(new l(0,0),new l(0,0)),new d(new l(1,-1),new l(-2,0)),new d(new l(1,0),new l(-1,-1)),new d(new l(0,1),new l(1,-1))]),new URL(R).href)}buildS(e,t){let n=new w(e+1,t+0,7,this.matrix),i=new w(e+0,t+0,7,this.matrix),s=new w(e+0,t+1,7,this.matrix),r=new w(e-1,t+1,7,this.matrix),a=new u([new d(new l(0,0),new l(0,0)),new d(new l(1,-1),new l(-2,0)),new d(new l(0,-1),new l(-1,1)),new d(new l(-1,0),new l(1,1))]);return new g([n,i,s,r],s,a,new u([new d(new l(0,0),new l(0,0)),new d(new l(-1,-1),new l(2,0)),new d(new l(-1,0),new l(1,-1)),new d(new l(0,1),new l(-1,-1))]),new URL(S).href)}}class L{constructor(e,t){this.columns=e,this.rows=t,this.matrix=Array.from({length:e},()=>Array(t).fill(0))}getColumns(){return this.columns}getRows(){return this.rows}at(e,t){return this.x=e,this.y=t,this}get(){return this.#d(),this.matrix[this.x][this.y]}set(e){this.#d(),this.matrix[this.x][this.y]=e}#d(){var e,t;if(null==this.x||null==this.y)throw Error(`Coord (x,y) must be set but are (${this.x},${this.y})`)}clearLines(){for(let e of this.#m())this.#x(e)}#m(){let e=[];for(let t=0;t<this.rows;t++){let n=!0;for(let e=0;e<this.columns&&n;e++)n=this.matrix[e][t]>0&&n;n&&e.push(t)}return e}#x(e){for(let t=e;t>0;t--)for(let e=0;e<this.columns;e++){let n=this.matrix[e][t-1];this.matrix[e][t]=n}}}class k{constructor(e){this.canvas=e}matrix(e){for(let t=0;t<e.getColumns();t++)for(let n=0;n<e.getRows();n++){let i=e.at(t,n).get();this.cell(t,n,i)}}piece(e){for(let t of e.getBlocks()){let[e,n]=t.getPosition(),i=t.getColor();this.cell(e,n,i)}}cell(e,t,n){if(0===n)return;let i=40*e,s=40*t;this.canvas.fillStyle=h[n%h.length],this.canvas.fillRect(i,s,40,40),this.canvas.strokeStyle=o[n%o.length],this.canvas.strokeRect(i,s,40,40)}clear(){this.canvas.fillStyle="white",this.canvas.fillRect(0,0,400,800)}gameOver(){this.canvas.font="48px roboto",this.canvas.fillStyle="#000000",this.canvas.fillText("Game Over!",85,376)}}class C{#g;#f;#v;constructor(e,t,n){this.#g=e,this.#f=t,this.#v=document.getElementById(n)}render(e){this.#f.clear(),this.#f.matrix(this.#g),this.#f.piece(e)}clearLines(){this.#g.clearLines()}gameOver(){this.#f.gameOver()}drawNext(e){let t=document.createElement("img");t.src=e,this.#v.innerHTML="",this.#v.appendChild(t)}static create(e,t,n){return new C(t,new k(document.getElementById(e).getContext("2d")),n)}}let E=null,A=null,F={ArrowLeft:()=>E.wannaLeft(),ArrowRight:()=>E.wannaRight(),Space:()=>E.wannaRotate(),Escape:()=>E.togglePause()};document.addEventListener("keyup",e=>{let{key:t,code:n}=e,i=F[n??t];i&&i()}),window.onload=()=>(function(){let e=new L(10,20);(E=new c(C.create("game",e,"next"),new T(e))).iterate(),A=window.setInterval(()=>{(function(){try{E.isOver||E.paused||E.iterate(),E.isOver&&(window.clearInterval(A),E.over())}catch(e){window.clearInterval(A),console.error(e)}})()},20)})()}();
//# sourceMappingURL=tetris.9ce1a602.js.map
