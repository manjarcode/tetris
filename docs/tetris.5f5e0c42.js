function e(e){return new URL(n+(e=r.i?.[e]||e),import.meta.url).toString()}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n="./",i={},s={},r=t.parcelRequire685b;null==r&&((r=function(e){if(e in i)return i[e].exports;if(e in s){var t=s[e];delete s[e];var n={id:e,exports:{}};return i[e]=n,t.call(n.exports,n,n.exports),n.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){s[e]=t},t.parcelRequire685b=r),r.register,Object.assign(r.i??={},{"1wXmP":"s.8adb7d0e.png",lp3Af:"t.1a22270f.png",fNXDJ:"l.66e5de53.png",gohSZ:"z.5c6e7042.png",l2LZ7:"stick.29508506.png","3zmZ0":"seven.a36daa0f.png","6NCrG":"square.02a09eec.png"});const a=["#FF6B6B","#FF9F1C","#FFD23F","#17C3B2","#227C9D","#8B5CF6","#E6E6EA"],h=["#C34C4C","#B36D14","#B8962E","#0F8175","#165166","#5A3EAB","#A1A1A5"];class w{constructor(e,t,n,i,s){this.x=e,this.y=t,this.color=n,this.matrix=i,this.snapshot=s}getPosition(){return new o(this.x,this.y)}getColor(){return this.color}canTranslate(e){return new w(this.x+e.x,this.y+e.y,this.color,this.matrix,this.snapshot).isValid()}translate(e){this.x=this.x+e.x,this.y=this.y+e.y}consolidate(){this.matrix.at(this.x,this.y).set(this.color)}toString(){return`(${this.x},${this.y})`}relativeTo(e){return new o(this.x-e.x,this.y-e.y)}takeSnapshot(){this.snapshot=[this.x,this.y]}isValid(){let e=this.x>=0&&this.x<10,t=this.y>=0&&this.y<20;return!!e&&!!t&&0===this.matrix.at(this.x,this.y).get()}}class o{constructor(e,t){this.x=e,this.y=t}*[Symbol.iterator](){yield this.x,yield this.y}toString(){return`${String(this.x)}${String(this.y)}`}}class l{#e;#t;#n;constructor(e,t){this.mainScreen=e,this.pieceBuilder=t,this.iteration=0,this.isOver=!1,this.#e=!1,this.#t=!1,this.active=this.pieceBuilder.getRandom(4,0),this.#n=this.pieceBuilder.getRandom(0,0),this.active.getImage(),this.mainScreen.drawNext(this.#n.getImage())}wannaLeft(){this.move=1}wannaRight(){this.move=2}wannaRotate(){this.#e=!0}togglePause(){this.#t=!this.#t}over(){this.mainScreen.gameOver()}iterate(){this.#t||(this.#i(),this.#e&&(this.active.wannaRotate(),this.#e=!1),this.#s()&&this.#r(),this.#a())}#i(){1===this.move&&this.active.wannaLeft(),2===this.move&&this.active.wannaRight(),this.move=0}#s(){return this.iteration++%10==0}#r(){this.active.canDown()?this.active.down():this.#h()}#h(){this.#w(),this.mainScreen.clearLines(),this.#o()}#w(){this.active.destroy(),this.active=null,this.active=this.#n,this.active.translate(new o(4,0)),this.#n=null,this.#n=this.pieceBuilder.getRandom(1,1),this.mainScreen.drawNext(this.#n.getImage())}#o(){this.isOver=!this.active.canDown()}#a(){this.mainScreen.render(this.active)}}class c{constructor(e){this.rotations=e}apply(e){let t=this.rotations.find(t=>t.from.x===e.x&&t.from.y===e.y);return t||console.log(`Rotation not found (${e.x},${e.y})`),t.to}}class u{constructor(e,t){this.from=e,this.to=t}}class d{#l;#c;constructor(e,t,n,i){this.#l=e.sort((e,t)=>t.y-e.y),this.rotateCenter=t,this.rotateTable=n,this.#c=i}getBlocks(){return this.#l}wannaLeft(){let e=new o(-1,0);this.translate(e)}wannaRight(){let e=new o(1,0);this.translate(e)}#u(e){return this.#l.every(t=>t.canTranslate(e))}translate(e){if(this.#u(e))for(let t of this.#l)t.translate(e)}wannaRotate(){this.canRotate()&&this.rotate()}canRotate(){throw Error("must be implemented")}rotate(){throw Error("must be implemented")}canDown(){let e=new o(0,1);return this.#u(e)}down(){let e=new o(0,1);this.translate(e)}destroy(){for(let e of this.#l)e.consolidate();for(let e of this.#l);}getImage(){return this.#c}toString(){return this.#l.map(e=>e.toString())}}class m extends d{constructor(e,t,n,i){super(e,t,n,i)}canRotate(){return!!this.rotateTable&&this.getBlocks().reduce((e,t)=>{let n=t.relativeTo(this.rotateCenter),i=this.rotateTable.apply(n);return e&&t.canTranslate(i)},!0)}rotate(){for(let e of this.getBlocks()){let t=e.relativeTo(this.rotateCenter),n=this.rotateTable.apply(t);e.translate(n)}}}class x extends d{constructor(e,t,n,i,s){super(e,t,n,s),this.isInverted=!1,this.reverseRotateTable=i}canRotate(){if(!this.rotateTable)return!1;let e=this.isInverted?this.reverseRotateTable:this.rotateTable;return this.getBlocks().reduce((t,n)=>{let i=n.relativeTo(this.rotateCenter),s=e.apply(i);return t&&n.canTranslate(s)},!0)}rotate(){let e=this.isInverted?this.reverseRotateTable:this.rotateTable;for(let t of this.getBlocks()){let n=t.relativeTo(this.rotateCenter),i=e.apply(n);t.translate(i)}this.isInverted=!this.isInverted}}var g={};g=e("6NCrG");var f={};f=e("lp3Af");var v={};v=e("3zmZ0");var p={};p=e("fNXDJ");var b={};b=e("l2LZ7");var y={};y=e("gohSZ");var R={};R=e("1wXmP");class S{constructor(e){this.matrix=e}getRandom(e,t){let n=[this.buildSquare,this.buildT,this.buildSeven,this.buildL,this.buildZ,this.buildS,this.buildStick],i=Math.floor(Math.random()*n.length);return n[i].bind(this)(e,t)}buildSquare(e,t){let n=new w(e+0,t+0,1,this.matrix),i=new w(e+1,t+0,1,this.matrix),s=new w(e+0,t+1,1,this.matrix);return new m([n,i,s,new w(e+1,t+1,1,this.matrix)],null,null,new URL(g).href)}buildT(e,t){let n=new w(e+1,t+0,2,this.matrix),i=new w(e+1,t+1,2,this.matrix),s=new w(e+1,t+2,2,this.matrix),r=new w(e+0,t+1,2,this.matrix);return new m([n,i,s,r],i,new c([new u(new o(0,0),new o(0,0)),new u(new o(-1,0),new o(1,-1)),new u(new o(1,0),new o(-1,1)),new u(new o(0,1),new o(-1,-1)),new u(new o(0,-1),new o(1,1))]),new URL(f).href)}buildSeven(e,t){let n=new w(e+0,t+0,3,this.matrix),i=new w(e+0,t+1,3,this.matrix),s=new w(e+0,t+2,3,this.matrix),r=new w(e+1,t+0,3,this.matrix);return new m([n,i,s,r],i,new c([new u(new o(0,0),new o(0,0)),new u(new o(-1,0),new o(1,-1)),new u(new o(1,0),new o(-1,1)),new u(new o(0,1),new o(-1,-1)),new u(new o(0,-1),new o(1,1)),new u(new o(1,-1),new o(0,2)),new u(new o(1,1),new o(-2,0)),new u(new o(-1,1),new o(0,-2)),new u(new o(-1,-1),new o(2,0))]),new URL(v).href)}buildL(e,t){let n=new w(e+1,t+0,4,this.matrix),i=new w(e+1,t+1,4,this.matrix),s=new w(e+1,t+2,4,this.matrix),r=new w(e+0,t+0,4,this.matrix);return new m([n,i,s,r],i,new c([new u(new o(0,0),new o(0,0)),new u(new o(-1,0),new o(1,-1)),new u(new o(1,0),new o(-1,1)),new u(new o(0,1),new o(-1,-1)),new u(new o(0,-1),new o(1,1)),new u(new o(1,-1),new o(0,2)),new u(new o(1,1),new o(-2,0)),new u(new o(-1,1),new o(0,-2)),new u(new o(-1,-1),new o(2,0))]),new URL(p).href)}buildStick(e,t){let n=new w(e+0,t+0,5,this.matrix),i=new w(e+0,t+1,5,this.matrix),s=new w(e+0,t+2,5,this.matrix),r=new w(e+0,t+3,5,this.matrix),a=new c([new u(new o(0,0),new o(0,0)),new u(new o(0,-1),new o(-1,1)),new u(new o(0,1),new o(1,-1)),new u(new o(0,2),new o(2,-2))]);return new x([n,i,s,r],i,a,new c([new u(new o(0,0),new o(0,0)),new u(new o(-1,0),new o(1,-1)),new u(new o(1,0),new o(-1,1)),new u(new o(2,0),new o(-2,2))]),new URL(b).href)}buildZ(e,t){let n=new w(e-1,t+0,6,this.matrix),i=new w(e+0,t+0,6,this.matrix),s=new w(e+0,t+1,6,this.matrix),r=new w(e+1,t+1,6,this.matrix),a=new c([new u(new o(0,0),new o(0,0)),new u(new o(-1,-1),new o(2,0)),new u(new o(0,-1),new o(1,1)),new u(new o(1,0),new o(-1,1))]);return new x([n,i,s,r],s,a,new c([new u(new o(0,0),new o(0,0)),new u(new o(1,-1),new o(-2,0)),new u(new o(1,0),new o(-1,-1)),new u(new o(0,1),new o(1,-1))]),new URL(y).href)}buildS(e,t){let n=new w(e+1,t+0,7,this.matrix),i=new w(e+0,t+0,7,this.matrix),s=new w(e+0,t+1,7,this.matrix),r=new w(e-1,t+1,7,this.matrix),a=new c([new u(new o(0,0),new o(0,0)),new u(new o(1,-1),new o(-2,0)),new u(new o(0,-1),new o(-1,1)),new u(new o(-1,0),new o(1,1))]);return new x([n,i,s,r],s,a,new c([new u(new o(0,0),new o(0,0)),new u(new o(-1,-1),new o(2,0)),new u(new o(-1,0),new o(1,-1)),new u(new o(0,1),new o(-1,-1))]),new URL(R).href)}}class T{constructor(e,t){this.columns=e,this.rows=t,this.matrix=Array.from({length:e},()=>Array(t).fill(0))}getColumns(){return this.columns}getRows(){return this.rows}at(e,t){return this.x=e,this.y=t,this}get(){return this.#d(),this.matrix[this.x][this.y]}set(e){this.#d(),this.matrix[this.x][this.y]=e}#d(){var e,t;if(null==this.x||null==this.y)throw Error(`Coord (x,y) must be set but are (${this.x},${this.y})`)}clearLines(){for(let e of this.#m())this.#x(e)}#m(){let e=[];for(let t=0;t<this.rows;t++){let n=!0;for(let e=0;e<this.columns&&n;e++)n=this.matrix[e][t]>0&&n;n&&e.push(t)}return e}#x(e){for(let t=e;t>0;t--)for(let e=0;e<this.columns;e++){let n=this.matrix[e][t-1];this.matrix[e][t]=n}}}class L{constructor(e){this.canvas=e}matrix(e){for(let t=0;t<e.getColumns();t++)for(let n=0;n<e.getRows();n++){let i=e.at(t,n).get();this.cell(t,n,i)}}piece(e){for(let t of e.getBlocks()){let[e,n]=t.getPosition(),i=t.getColor();this.cell(e,n,i)}}cell(e,t,n){if(0===n)return;let i=40*e,s=40*t;this.canvas.fillStyle=a[n%a.length],this.canvas.fillRect(i,s,40,40),this.canvas.strokeStyle=h[n%h.length],this.canvas.strokeRect(i,s,40,40)}clear(){this.canvas.fillStyle="white",this.canvas.fillRect(0,0,400,800)}gameOver(){this.canvas.font="48px roboto",this.canvas.fillStyle="#000000",this.canvas.fillText("Game Over!",85,376)}}class C{#g;#f;#v;constructor(e,t,n){this.#g=e,this.#f=t,this.#v=document.getElementById(n)}render(e){this.#f.clear(),this.#f.matrix(this.#g),this.#f.piece(e)}clearLines(){this.#g.clearLines()}gameOver(){this.#f.gameOver()}drawNext(e){let t=document.createElement("img");t.src=e,this.#v.innerHTML="",this.#v.appendChild(t)}static create(e,t,n){return new C(t,new L(document.getElementById(e).getContext("2d")),n)}}let k=null,A=null;const E={ArrowLeft:()=>k.wannaLeft(),ArrowRight:()=>k.wannaRight(),Space:()=>k.wannaRotate(),Escape:()=>k.togglePause()};document.addEventListener("keyup",e=>{let{key:t,code:n}=e,i=E[n??t];i&&i()}),window.onload=()=>(function(){let e=new T(10,20);(k=new l(C.create("game",e,"next"),new S(e))).iterate(),A=window.setInterval(()=>{(function(){try{k.isOver||k.paused||k.iterate(),k.isOver&&(window.clearInterval(A),k.over())}catch(e){window.clearInterval(A),console.error(e)}})()},20)})();
//# sourceMappingURL=tetris.5f5e0c42.js.map
